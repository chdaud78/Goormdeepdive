<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>FORM</title>
    <link rel="stylesheet" href="../../day13/mission/toast.css">
    <script src="../../day13/mission/toast.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Pretendard', sans-serif;
            background: #f4f6f8;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 60px;
        }
        .form-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            width: 360px;
        }
        .form-wrap {
            background-color: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .input-wrap {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        label {
            font-weight: 500;
            font-size: 14px;
            color: #333;
        }
        input {
            padding: 10px 14px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.2s;
        }
        input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            background-color: #4f46e5;
            color: white;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;

            &:hover {
                background-color: #4338ca;
            }

            &.btn-count {
                background-color: #4CAF50;

                &:hover {
                    background-color: green;
                }
            }
        }

        .user-count {
            margin: 0;
            padding: 12px 16px;
            border-radius: 8px;
            background-color: #e0e7ff;
            color: #1e3a8a;
            font-weight: 500;
            font-size: 14px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(30, 58, 138, 0.1);
        }

        .result-box {
            padding: 10px 20px;
            box-shadow: 0 2px 4px rgba(30, 58, 138, 0.1);
            color: white;

            &.success {
                background-color: #4CAF50;
            }

            &.fail {
                background-color: #ff0000;
            }
        }
    </style>
</head>
<body>
<div class="form-container">
    <div class="result-box"></div>
    <div class="form-wrap create-form">
        <div class="input-wrap">
            <label for="name">이름</label>
            <input class="name" id="name" type="text">
        </div>
        <div class="input-wrap">
            <label for="password">비밀번호</label>
            <input class="password" id="password" type="password">
        </div>
        <button class="btn btn-create">생성</button>
    </div>
    <div class="form-wrap password-form">
        <div class="input-wrap">
            <label for="passwordCheck">비밀번호 확인</label>
            <input class="password-check" id="passwordCheck" type="password">
        </div>
        <button class="btn btn-check">비밀번호 확인</button>
    </div>
    <p class="user-count">전체 사용자 수 : 0명</p>
    <button class="btn btn-count">사용자수 확인</button>
</div>
</body>
<script>
  class User {
    static count = 0;
    #password;
    _name;

    constructor(name, password) {
      this.name = name;
      this.#setPassword(password);
      User.count += 1;
    }

    get name() {
      return this._name.toUpperCase();
    }

    set name(value) {
      if (value.length < 2) {
        throw new Error("이름은 두 글자 이상 입니다.");
      }
      this._name = value;
    }

    #setPassword(pw) {
      if (pw.length < 6) {
        throw new Error("비밀번호는 6자리 이상이어야 합니다.");
      }
      this.#password = pw;
    }

    checkPassword(inputPw) {
      return inputPw === this.#password;
    }

    static getCount() {
      return User.count;
    }
  }

    const users = [];

    const nameInput = document.getElementById("name");
    const passwordInput = document.getElementById("password");
    const checkPwInput = document.getElementById("passwordCheck");
    const userBox = document.querySelector('.user-count');

    const btnCreate = document.querySelector('.btn-create');
    const btnCheck = document.querySelector('.btn-check');
    const btnCount = document.querySelector('.btn-count');

    const resultBox = document.querySelector('.result-box');

    const errorMessages = {
        '이미 존재하는 이름입니다.': '이미 존재하는 이름입니다!',
        '이름은 두 글자 이상 입니다.': '이름은 두 글자 이상 입니다.',
        '비밀번호는 6자리 이상이어야 합니다.': '비밀번호는 6자리 이상이어야 합니다.',
    };

    btnCreate.addEventListener('click', () => {
      try {
        const nameValue = nameInput.value.trim();
        const passwordValue = passwordInput.value;

        // 이름 중복 검사
        const isDuplicate = users.some((user) => user.name === nameValue.toUpperCase());
        if (isDuplicate) {
          throw new Error("이미 존재하는 이름입니다.");
        }

        const user = new User(nameValue, passwordValue);
        users.push(user);


        new Toast('생성 완료!', { type: 'success', duration: 3000, position:'top-right' })
      } catch (err) {
        const msg = errorMessages[err.message] || '생성 실패!';
        new Toast(msg, { type: 'error', duration: 3000, position: 'top-right' });
        console.log(err);
      }
    })

    btnCheck.addEventListener('click', () => {
        const checkPwValue = checkPwInput.value;
        const user = users[users.length - 1];
        const check = user.checkPassword(checkPwValue);
        if(check) {
          new Toast('비밀 번호가 일치합니다!', { type: 'success', duration: 3000, position:'top-right' })
        } else {
          resultBox.classList.remove('success');
          resultBox.classList.add('fail', 'show');
          new Toast('비밀 번호가 일치하지 않습니다!', { type: 'error', duration: 3000, position:'top-right' })
        }

        console.log(users);
    })

    btnCount.addEventListener('click', () => {
        userBox.innerHTML = `전체 사용자 수 : ${User.getCount()}명`;
    })
</script>

</html>