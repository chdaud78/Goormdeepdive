<!Doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8"/>
    <title>Tag Bookmark</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <style>
        li {
            list-style: none;
        }

        :root {
            --bg: #0b0c10;
            --fg: #eaf0f1;
            --muted: #9aa0a6;
            --card: #11151a;
            --accent: #4f8cff;
        }

        body {
            margin: 0;
            font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            background: var(--bg);
            color: var(--fg);
        }

        .bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #222;
        }

        .controls {
            display: grid;
            gap: 8px;
            padding: 12px 16px;
            background: var(--card);
            border-bottom: 1px solid #222;
        }

        #add-form {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 8px;
        }

        .filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            padding: 16px;
        }

        .card {
            background: var(--card);
            border: 1px solid #1c2430;
            border-radius: 12px;
            padding: 12px;
            display: grid;
            gap: 8px;
        }

        .card h3 {
            margin: 0;
            font-size: 15px;
        }

        .muted {
            color: var(--muted);
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            padding: 2px 8px;
            border-radius: 999px;
            background: var(--card);
            color: var(--muted);
            cursor: pointer;
            user-select: none;
            border-width: 1px;
            border-style: solid;
            border-color: var(--fg)
        }

        .actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
        }

        button,
        input,
        select {
            background: var(--card);
            color: var(--fg);
            border: 1px solid #273040;
            border-radius: 8px;
            padding: 8px;
        }

        button {
            cursor: pointer;
        }

        .stats {
            padding: 12px 16px;
            border-top: 1px solid #222;
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            color: var(--muted);
        }

        .light {
            --bg: #f7f8fb;
            --fg: #0b0c10;
            --muted: #566;
            --card: #ffffff;
            --accent: #2a66ff;
        }

        .toast {
            background: #111a;
            backdrop-filter: blur(6px);
            color: #fff;
            padding: 10px 12px;
            border-radius: 10px;
        }

        #toast-root {
            position: fixed;
            right: 16px;
            bottom: 16px;
            display: grid;
            gap: 8px;
        }

        a {
            color: var(--accent);
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        @media (max-width: 720px) {
            #add-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
<header class="bar">
    <h1>Tag Notes (Lite)</h1>
    <div style="display:flex;gap:8px;">
        <button type="button" id="theme-btn">üåì</button>
    </div>
</header>

<section class="controls">
    <form id="add-form" autocomplete="off">
        <input id="title" placeholder="Ï†úÎ™©" required/>
        <input id="url" placeholder="ÎßÅÌÅ¨(URL) ÎòêÎäî Î©îÎ™®"/>
        <input id="tags" placeholder="ÌÉúÍ∑∏(ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)"/>
        <button type="submit">Ï∂îÍ∞Ä</button>
    </form>

    <div class="filters">
        <input id="q" placeholder="Í≤ÄÏÉâ(Ï†úÎ™©/ÌÉúÍ∑∏) ‚Äî 300ms ÎîîÎ∞îÏö¥Ïä§"/>
        <select id="sort">
            <option value="recent">Ï†ïÎ†¨: ÏµúÏã†</option>
            <option value="title">Ï†ïÎ†¨: Ï†úÎ™©</option>
            <option value="tags">Ï†ïÎ†¨: ÌÉúÍ∑∏Ïàò</option>
        </select>
        <button type="button" id="clear-filters">ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî</button>
    </div>
</section>

<section class="grid" id="list"></section>
<aside class="stats" id="stats"></aside>
<div id="toast-root"></div>

<script>
  /* =========================
      ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º ÌÅ¥ÎûòÏä§
  ========================= */
  class Toast {
    constructor(rootId) {
      this.$root = document.getElementById(rootId);
    }
    show(message) {
      const el = document.createElement('div');
      el.className = 'toast';
      el.textContent = message;
      this.$root.appendChild(el);
      setTimeout(() => {
        el.remove();
      }, 2200);
    }
  }
  const toast = new Toast('toast-root');

  /* =========================
        ÏÉÅÌÉú Íµ¨ÎèÖ & Î†åÎçîÎßÅ
  ========================= */
  const $list = document.getElementById('list');
  const $stats = document.getElementById('stats');
  const $q = document.getElementById('q');
  const $sort = document.getElementById('sort');
  const $clearFilters = document.getElementById('clear-filters');

  function render(state) {
    const items = store.filtered();

    // Î¶¨Ïä§Ìä∏ Î†åÎçî
    $list.innerHTML = items.map(item => `
    <div class="card">
      <h3><a href="${escapeHtml(item.url)}" target="_blank">${escapeHtml(item.title)}</a></h3>
      <div class="muted">${new Date(item.createdAt).toLocaleString()}</div>
      <div class="tags">
        ${item.tags.map(tag => `<span class="tag" data-tag="${escapeHtml(tag)}">${escapeHtml(tag)}</span>`).join('')}
      </div>
      <div class="actions">
        <button data-id="${item.id}" class="del-btn">ÏÇ≠Ï†ú</button>
      </div>
    </div>
  `).join('');

    // ÌÜµÍ≥Ñ Î†åÎçî
    $stats.textContent = `Ï¥ù ${state.items.length}Í∞ú / ÌïÑÌÑ∞ÎßÅ ${items.length}Í∞ú`;
  }

  /* =========================
            Ïù¥Î≤§Ìä∏ Î∞îÏù∏Îî©
  ========================= */
  document.getElementById('add-form').addEventListener('submit', e => {
    e.preventDefault();
    const title = clamp(document.getElementById('title').value);
    const url = clamp(document.getElementById('url').value);
    const tags = tagSplit(document.getElementById('tags').value);

    if (!title) return;

    store.set(state => ({
      ...state,
      items: [
        ...state.items,
        {
          id: uid(),
          title,
          url,
          tags,
          createdAt: new Date().toISOString()
        }
      ]
    }));

    e.target.reset();
    toast.show('Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§.');
  });

  // Í≤ÄÏÉâ ÎîîÎ∞îÏö¥Ïä§
  let searchTimer;
  $q.addEventListener('input', e => {
    clearTimeout(searchTimer);
    searchTimer = setTimeout(() => {
      const q = e.target.value;
      store.set(state => ({
        ...state,
        filter: { ...state.filter, q }
      }));
    }, 300);
  });

  // Ï†ïÎ†¨ Î≥ÄÍ≤Ω
  $sort.addEventListener('change', e => {
    store.set(state => ({
      ...state,
      filter: { ...state.filter, sort: e.target.value }
    }));
  });

  // ÌïÑÌÑ∞ Ï¥àÍ∏∞Ìôî
  $clearFilters.addEventListener('click', () => {
    store.set(state => ({
      ...state,
      filter: { q: '', selected: new Set(), sort: 'recent' }
    }));
    $q.value = '';
    $sort.value = 'recent';
    toast.show('ÌïÑÌÑ∞Í∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
  });

  // ÌÉúÍ∑∏ ÌÅ¥Î¶≠ ÌïÑÌÑ∞
  $list.addEventListener('click', e => {
    const tag = e.target.dataset.tag;
    if (tag) {
      store.set(state => {
        const selected = new Set(state.filter.selected);
        if (selected.has(tag)) {
          selected.delete(tag);
        } else {
          selected.add(tag);
        }
        return { ...state, filter: { ...state.filter, selected } };
      });
    }
  });

  // ÏÇ≠Ï†ú Î≤ÑÌäº
  $list.addEventListener('click', e => {
    if (e.target.classList.contains('del-btn')) {
      const id = e.target.dataset.id;
      store.set(state => ({
        ...state,
        items: state.items.filter(item => item.id !== id)
      }));
      toast.show('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.');
    }
  });

  /* =========================
          Store Ï¥àÍ∏∞Ìôî
  ========================= */
  store.subscribe(render);
  render(store.get());
</script>
</body>
</html>
